query: drop table tmptable
query: create table tmptable(key string, value int)
query: explain 
insert overwrite table tmptable
  select unionsrc.key, unionsrc.value FROM (select 'tst1' as key, count(1) as value from src s1
                                        UNION  ALL  
                                            select 'tst2' as key, count(1) as value from src1 s2
                                        UNION ALL
                                            select 'tst3' as key, count(1) as value from srcbucket s3) unionsrc
ABSTRACT SYNTAX TREE:
  (TOK_QUERY (TOK_FROM (TOK_SUBQUERY (TOK_UNION (TOK_UNION (TOK_QUERY (TOK_FROM (TOK_TABREF src s1)) (TOK_INSERT (TOK_DESTINATION (TOK_DIR TOK_TMP_FILE)) (TOK_SELECT (TOK_SELEXPR 'tst1' key) (TOK_SELEXPR (TOK_FUNCTION count 1) value)))) (TOK_QUERY (TOK_FROM (TOK_TABREF src1 s2)) (TOK_INSERT (TOK_DESTINATION (TOK_DIR TOK_TMP_FILE)) (TOK_SELECT (TOK_SELEXPR 'tst2' key) (TOK_SELEXPR (TOK_FUNCTION count 1) value))))) (TOK_QUERY (TOK_FROM (TOK_TABREF srcbucket s3)) (TOK_INSERT (TOK_DESTINATION (TOK_DIR TOK_TMP_FILE)) (TOK_SELECT (TOK_SELEXPR 'tst3' key) (TOK_SELEXPR (TOK_FUNCTION count 1) value))))) unionsrc)) (TOK_INSERT (TOK_DESTINATION (TOK_TAB tmptable)) (TOK_SELECT (TOK_SELEXPR (. (TOK_TABLE_OR_COL unionsrc) key)) (TOK_SELEXPR (. (TOK_TABLE_OR_COL unionsrc) value)))))

STAGE DEPENDENCIES:
  Stage-1 is a root stage
  Stage-2 depends on stages: Stage-1, Stage-3, Stage-4
  Stage-0 depends on stages: Stage-2
  Stage-3 is a root stage
  Stage-2 depends on stages: Stage-1, Stage-3, Stage-4
  Stage-0 depends on stages: Stage-2
  Stage-4 is a root stage
  Stage-2 depends on stages: Stage-1, Stage-3, Stage-4
  Stage-0 depends on stages: Stage-2

STAGE PLANS:
  Stage: Stage-1
    Map Reduce
      Alias -> Map Operator Tree:
        null-subquery1-subquery1:unionsrc-subquery1-subquery1:s1 
            Select Operator
              Group By Operator
                aggregations:
                      expr: count(1)
                mode: hash
                Reduce Output Operator
                  sort order: 
                  tag: -1
                  value expressions:
                        expr: 0
                        type: bigint
      Reduce Operator Tree:
        Group By Operator
          aggregations:
                expr: count(VALUE.0)
          mode: mergepartial
          Select Operator
            expressions:
                  expr: 'tst1'
                  type: string
                  expr: 0
                  type: bigint
            File Output Operator
              compressed: false
              GlobalTableId: 0
              table:
                  input format: org.apache.hadoop.mapred.SequenceFileInputFormat
                  output format: org.apache.hadoop.hive.ql.io.HiveSequenceFileOutputFormat
                  name: binary_table

  Stage: Stage-2
    Map Reduce
      Alias -> Map Operator Tree:
        /data/users/athusoo/commits/hive_trunk_ws8/build/ql/tmp/1200507308/759713067.10002 
          Union
            Select Operator
              expressions:
                    expr: 0
                    type: string
                    expr: 1
                    type: bigint
              Select Operator
                expressions:
                      expr: 0
                      type: string
                      expr: UDFToInteger(1)
                      type: int
                File Output Operator
                  compressed: false
                  GlobalTableId: 1
                  table:
                      input format: org.apache.hadoop.mapred.TextInputFormat
                      output format: org.apache.hadoop.hive.ql.io.HiveIgnoreKeyTextOutputFormat
                      serde: org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe
                      name: tmptable
        /data/users/athusoo/commits/hive_trunk_ws8/build/ql/tmp/1200507308/759713067.10003 
          Union
            Select Operator
              expressions:
                    expr: 0
                    type: string
                    expr: 1
                    type: bigint
              Select Operator
                expressions:
                      expr: 0
                      type: string
                      expr: UDFToInteger(1)
                      type: int
                File Output Operator
                  compressed: false
                  GlobalTableId: 1
                  table:
                      input format: org.apache.hadoop.mapred.TextInputFormat
                      output format: org.apache.hadoop.hive.ql.io.HiveIgnoreKeyTextOutputFormat
                      serde: org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe
                      name: tmptable
        /data/users/athusoo/commits/hive_trunk_ws8/build/ql/tmp/1200507308/759713067.10004 
          Union
            Select Operator
              expressions:
                    expr: 0
                    type: string
                    expr: 1
                    type: bigint
              Select Operator
                expressions:
                      expr: 0
                      type: string
                      expr: UDFToInteger(1)
                      type: int
                File Output Operator
                  compressed: false
                  GlobalTableId: 1
                  table:
                      input format: org.apache.hadoop.mapred.TextInputFormat
                      output format: org.apache.hadoop.hive.ql.io.HiveIgnoreKeyTextOutputFormat
                      serde: org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe
                      name: tmptable

  Stage: Stage-0
    Move Operator
      tables:
            replace: true
            table:
                input format: org.apache.hadoop.mapred.TextInputFormat
                output format: org.apache.hadoop.hive.ql.io.HiveIgnoreKeyTextOutputFormat
                serde: org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe
                name: tmptable

  Stage: Stage-3
    Map Reduce
      Alias -> Map Operator Tree:
        null-subquery1-subquery2:unionsrc-subquery1-subquery2:s2 
            Select Operator
              Group By Operator
                aggregations:
                      expr: count(1)
                mode: hash
                Reduce Output Operator
                  sort order: 
                  tag: -1
                  value expressions:
                        expr: 0
                        type: bigint
      Reduce Operator Tree:
        Group By Operator
          aggregations:
                expr: count(VALUE.0)
          mode: mergepartial
          Select Operator
            expressions:
                  expr: 'tst2'
                  type: string
                  expr: 0
                  type: bigint
            File Output Operator
              compressed: false
              GlobalTableId: 0
              table:
                  input format: org.apache.hadoop.mapred.SequenceFileInputFormat
                  output format: org.apache.hadoop.hive.ql.io.HiveSequenceFileOutputFormat
                  name: binary_table

  Stage: Stage-4
    Map Reduce
      Alias -> Map Operator Tree:
        null-subquery2:unionsrc-subquery2:s3 
            Select Operator
              Group By Operator
                aggregations:
                      expr: count(1)
                mode: hash
                Reduce Output Operator
                  sort order: 
                  tag: -1
                  value expressions:
                        expr: 0
                        type: bigint
      Reduce Operator Tree:
        Group By Operator
          aggregations:
                expr: count(VALUE.0)
          mode: mergepartial
          Select Operator
            expressions:
                  expr: 'tst3'
                  type: string
                  expr: 0
                  type: bigint
            File Output Operator
              compressed: false
              GlobalTableId: 0
              table:
                  input format: org.apache.hadoop.mapred.SequenceFileInputFormat
                  output format: org.apache.hadoop.hive.ql.io.HiveSequenceFileOutputFormat
                  name: binary_table


query: insert overwrite table tmptable
  select unionsrc.key, unionsrc.value FROM (select 'tst1' as key, count(1) as value from src s1
                                        UNION  ALL  
                                            select 'tst2' as key, count(1) as value from src1 s2
                                        UNION ALL
                                            select 'tst3' as key, count(1) as value from srcbucket s3) unionsrc
Input: default/src
Input: default/src1
Input: default/srcbucket
Output: default/tmptable
query: select * from tmptable x sort by x.key
Input: default/tmptable
Output: /data/users/athusoo/commits/hive_trunk_ws8/ql/../build/ql/tmp/401912347/42136443.10000
tst1	500
tst2	25
tst3	1000
query: drop table tmptable
